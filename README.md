# hustAIA_matlab_war_simulation

华中科技大学人工智能与自动化学院系统仿真与matlab专选课课程设计，选题为战争模型
- 课程成绩：94
- 作者：叶庭宏
---
### 1. 程序运行指南

1. 运行war_simulation.m程序，出现仿真界面。
2. 参数设定：仿真画面的左侧上下部分区域分别对应甲方军队和乙方军队的兵力、射击率以及战争持续时间等各项要求参数，右上角则是设定的战争持续时间和混合战中正规战所占的比例。用户可根据需求自行设定或直接点击右侧的“随机参数”按钮。若未设定则使用默认值进行仿真过程。
3. 选择作战类型：点击右上角的下拉框，可供选择“正规战、游击战、混合战”三种作战类型。若未选择，则默认为游击战。
4. 点击右上角的“开始模拟”按钮，启动仿真。


### 2. UI界面

![[attachments/Pasted image 20250402204919.png]]


### 3. 程序流程图

![[attachments/Pasted image 20250402205054.png]]


### 4. 关键难点
#### 1. **模拟战场动画及自动避障算法**

为了模拟出战场上士兵移动的动态效果，同时直观的反映出作战双方兵力的强弱对比和变化情况，也是为了满足题目对仿真过程的要求，我设计了一种模拟**士兵运动和避障**（撞到壁垒、石块或掉进河里）的算法。

首先，程序通过for循环来实现动画的每一帧，由于在运行完solveODE函数后得到了描述战争全过程的兵力变化的数组x_t和y_t，故可以在每一次循环中读取当前的x和y，即双方兵力的实时人数，从而用于士兵绘制。每个士兵独立计算新位置，通过尝试-检测-更新的方式逐步避开障碍物，并在战场内合理分布。

**士兵避障算法**：采用**障碍物矩阵映射**、**随机采样和循环分区检测**，确保士兵生成和移动时不会进入障碍物区域。通过对障碍物地图进行坐标范围检查（checkObstacle函数），动态调整士兵位置。

![[attachments/Pasted image 20250402205313.png]]
> 注：输入兵力较大时显然可见，士兵会自动避开石块、壁垒、河流等障碍物

随机位置移动：每帧更新时，士兵的位置按照随机方向偏移，同时通过边界约束（min和max函数）和障碍物检测保持位置合法。模拟了士兵在战场上的随机移动和隐蔽性，体现了战争的动态性。

边界约束：通过对加上随机数后超出战场范围的点进行上下限约束，限制士兵活动在设定区域内，避免位置越界，确保仿真合理性。

实时可视化：通过set函数更新士兵位置和数量曲线，使结果动态显示为动画。同时，为了实现帧率控制，通过pause调整动画速度，增强用户体验。

#### 2. **仿真末端离散点的优化处理**

通过ode45函数求解得到的兵力和时间数组序列数量较少，往往不超过三位数，导致的问题有：绘制兵力变化曲线时，倘若某方人数降为0，往往无法在人数恰好等于0时截断，而是在大于0或小于0时。如果取到大于0的点来实现截断，则曲线末端会少一截，不符合实际战场情况，减弱了仿真的真实性。如果取到小于0的点，则显示人数将为负，显然不符合现实。

因此我采取的方案是：取双方第一个小于0的点作为**截断序列号**，同时将该负值设置为0，则显示结果符合现实逻辑，且不影响全局趋势。

![[attachments/Pasted image 20250402205442.png]]


#### 3. **动静态双层分割一键清屏方法**

为了实现清屏只清除士兵和曲线而不清除背景，我采用了**划分动态层和静态层**的方法，将静态层作为背景统一归入ax1，将动态层作为士兵统一归入ax3，且动态层设置为透明，以显示底层背景。如此操作即可实现仿真运行过程中的一键清屏。

实现该功能过程中困扰我的问题及其解决方案：测试清屏功能时，我发现会出现如下报错：
![[attachments/Pasted image 20250402205508.png]]

经过debug排查后我发现是因为回调函数的逻辑类似于中断函数，当start_simulation的模拟功能回调函数正在运行时，按了一键清屏跳转到cleanax的回调函数，会记下跳出函数的位置，从而在执行完内层函数后再返回到原位置继续执行。然而内层函数清除了ax2和ax3，导致在外层函数中原ax3的句柄无效，导致函数的后续部分执行出问题。但这个中断位置是不能控制的，不能多线程进行。

我的解决方案是设置一个全局bool变量simulation_running作为控制符，当进入内层函数cleanax时，将控制符设为false，并在外层函数使用ax3的句柄前检查控制符，若为false则直接break中止动画。此思路同样可以迁移到模拟过程中关闭仿真窗口出现报错的情况，成功解决。

---
